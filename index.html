<!DOCTYPE html>
<html lang="EN">
<head>
  <meta charset="utf-8"/>
  <title>UnionPM</title>
  <style>
    * {
      padding: 0;
      margin: 0;
    }

    canvas {
      background: #eee;
      display: block;
      margin: 0 auto;
    }

    input[type='range']::-webkit-slider-thumb {
      width: 20px;
      height: 20px
    }

  </style>
  <link rel="stylesheet" href="css/main.css">
</head>

<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script type="text/javascript" >

  let TOKEN = "";

  vkBridge.send('VKWebAppInit');

  vkBridge.send('VKWebAppGetAuthToken', {
    app_id:51572062,
    scope: ''
  })
    .then((data) => {
      if (data["access_token"]) {
        TOKEN = data["access_token"];
        // console.log(JSON.stringify(data));
      }
    })
    .catch((error) => {
      // Ошибка
      console.log(error);
    });
  let id, first_name, last_name

  vkBridge.send('VKWebAppGetUserInfo', {
  })
    .then((data) => {
      if (data.id) {
        id= data.id;
        first_name=data["first_name"];
        last_name=data["last_name"];

      }
    })
    .catch((error) => {
      // Ошибка
      console.log(error);
    });


</script>

<script src="js/level1.js"></script>

<body style="background-color: white; height: 100%; overflow: hidden">

<div class="title" style="margin: 30px 30px 10px 30px; display: flex;">
  <h3 style="
    width: 100%;
">UnionPM Game</h3>
  <p style="min-width: 100px;" id="levelIndex">Level 1</p>
</div>
<div  style="margin: 10px 30px 10px 30px; display: flex;">

  <p style="
    width: 100%;
">Version: 0.4.1 Alpha</p>
<!--  <a href="https://vk.com/wixby43" style="text-decoration: none; min-width: 100px;">Author: Wix</a>-->
</div>
<div id="js-container">
  <canvas id="myCanvas" width="380" height="550"></canvas>
  <div
    id="gameWin"
    style="
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: white;
      /*-webkit-text-stroke: 3px black;*/
    "
  >
    YOU WIN!
  <div id="nextLevelBtn" style="
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      display: none;
    ">
    <a >
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      Next level->>
    </a>

  </div>
  </div>
</div>

<form name="quiz" id="tg" action="javascript:check();" class="quiz-form" style="display: none;">
  <div class="quiz-section">
    <h2>Пойдешь на концерт?</h2>

    <div class="answer">
      <label for="value1"></label><input name="q1" value="true" id="value1" type="radio" checked="checked" /> Конечно!
    </div>

    <div class="answer">
      <label for="value2"></label><input name="q1" value="false" id="value2" type="radio" /> Нет, не смогу(
    </div>
  </div>
  <input value="Submit" type="submit" />
</form>

<script type="text/javascript" >

  const CHAT_ID = "-1001826284527";
  const URI_API = 'https://api.telegram.org/bot799604842:AAHnQSUGIui4pUP-PO4wBtSkYNCdxmWYc4E/sendMessage';

  document.getElementById("tg").addEventListener('submit', function (e) {
    e.preventDefault();

    let message = "";


    if (this.q1.value === "true") {
      message = "Новый зритель! " + last_name + " " + first_name + " id: " + id;
    } else {
      message += "Лох отказался идти: " + last_name + " " + first_name + " id: " + id;
    }

    axios.post(URI_API, {
      chat_id: CHAT_ID,
      text: message
    });

  }, false);

  let result;

  function check() {
    let question = 1;

    result = "";

    let choice;
    let q = document.forms['quiz'].elements['q' + question];
    for (let i = 0; i < q.length; i++) {
      if (q[i].checked) {
        choice = q[i].value;
        console.log(choice);
      }
    }
  }

</script>
<script src="js/level2.js"></script>

</body>
</html>
