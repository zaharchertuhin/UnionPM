<!DOCTYPE html>
<html lang="EN">
<head>
  <meta charset="utf-8"/>
  <title>UnionPM</title>
  <style>
    * {
      padding: 0;
      margin: 0;
    }

    canvas {
      background: #eee;
      display: block;
      margin: 0 auto;
    }

    input[type='range']::-webkit-slider-thumb {
      width: 20px;
      height: 20px
    }

  </style>
</head>
<body style="background-color: white; height: 100%; overflow: hidden">

<script src="https://vk.com/js/api/xd_connection.js?2" type="text/javascript"></script>

<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

<script>
  vkBridge.send('VKWebAppInit');

  const response = await fetch("https://api.vk.com/method/user_id", {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: `{
    "Authorization" : "Bearer"
  }`,
  });

  response.json().then(data => {
    console.log(JSON.stringify(data));
  });

</script>
<div class="title" style="margin: 30px 30px 10px 30px; display: flex;">
  <h3 style="
    width: 100%;
">UnionPM Game</h3>
  <p style="min-width: 100px;">Level 1</p>
</div>
<div  style="margin: 10px 30px 10px 30px; display: flex;">

  <p style="
    width: 100%;
">Version: Alpha</p>
  <a href="https://vk.com/wixby43" style="text-decoration: none; min-width: 100px;">Author: Wix</a>
</div>

<canvas id="myCanvas" width="380" height="550"></canvas>

<div style="justify-content: center;display: flex;">

</div>

<div class="nxtLvlBtn">
  <a href="level2.html"><button>Next Level</button></a>
</div>

<script>

  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let x = canvas.width / 2;
  let y = canvas.height - 30;
  let brickCount = 3;
  let brickWidth = 50;
  let brickHeight = 15;

  let brickOffsetTop = 30;
  let brickOffsetLeft = 30;
  let score = 0;

  let bricks = [];
  for (let i = 0; i < brickCount; i++) {
      bricks[i] = {x: 0, y: 0, status: 1};

  }

  let coords = [{x: 100, y: 200,}, {x: 200, y: 100,}, {x: 150, y: 150,}];

  // canvas.addEventListener('mousemove', function(event) {
  //   x = event.pageX - canvas.offsetLeft;
  //   y = event.pageY - canvas.offsetTop;
  //   console.log("x: " + x + " y: " + y);
  // }, false);

  function win() {
    alert("YOU WIN, CONGRATS!");
    document.location.assign("level2.html");
    console.log("Win")
  }

    canvas.addEventListener('click', function(event) {
      x = event.pageX - canvas.offsetLeft;
      y = event.pageY - canvas.offsetTop;
      for (let c = 0; c < brickCount; c++) {

          let element = bricks[c];

          if (y > element.y  && y < element.y + brickHeight
            && x > element.x  && x < element.x + brickWidth) {
            console.log("Brick clicked "+ "x: " + element.x+ " : y " + element.y)
            score++;
            element.status = 0;
            if(score === bricks.length){
              win();
            }
         }
        }

    }, false);



    // canvas.addEventListener('click', function () {}, false);
    // for (var c = 0; c < brickColumnCount; c++) {
    //   for (var r = 0; r < brickRowCount; r++) {
    //     let b = bricks[c][r];
    //     // b.addEventListener('click', (b) => {
    //     //   b.remove;
    //     // }, false);
    //     // if(x > b.x - brickWidth && x < b.x + brickWidth && y > b.y - brickHeight && y < b.y + brickHeight){
    //       console.log("Brick clicked");
    //       // b.remove();
    //
    //     // }
    //
    //   }
    // }
  // }

  // function collisionDetection() {
  //   for (var c = 0; c < brickCount; c++) {
  //
  //       let b = bricks[c];
  //       if (b.status === 1) {
  //         if (x > b.x && x < b.x + brickWidth && y > b.y && y < b.y + brickHeight) {
  //           score++;
  //           if (score === bricks.length) {
  //             alert("YOU WIN, CONGRATS!");
  //             document.location.reload();
  //
  //           }
  //         }
  //
  //     }
  //   }
  // }

  function drawBricks() {
    for (let c = 0; c < brickCount; c++) {
        if (bricks[c].status === 1) {
          let brickX = coords[c].x + brickOffsetLeft;
          let brickY = coords[c].y + brickOffsetTop;
          bricks[c].x = brickX;
          bricks[c].y = brickY;

          ctx.beginPath();
          ctx.rect(brickX, brickY, brickWidth, brickHeight);
          ctx.fillStyle = "#0095DD";
          ctx.fill();
          ctx.closePath();
        }
      }

  }



  function drawScore() {
    ctx.font = "16px Arial";
    ctx.fillStyle = "#0095DD";
    ctx.fillText("Score: " + score, 8, 20);
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBricks();

    drawScore();

    requestAnimationFrame(draw);
  }

  draw();

</script>

</body>
</html>
